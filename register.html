<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetify - Rejestracja</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
</head>
<body>
    <div class="register-container">
        <div class="register-box">
            <div class="register-header">
                <img src="images/logo.png" alt="Meetify" class="register-logo">
                <h1>Dołącz do Meetify</h1>
            </div>
            
            <form id="register-form">
                <div class="form-group">
                    <label for="username">Nazwa użytkownika</label>
                    <input type="text" id="username" required>
                </div>
                
                <div class="form-group">
                    <label for="firstName">Imię</label>
                    <input type="text" id="firstName" required>
                </div>
                
                <div class="form-group">
                    <label for="lastName">Nazwisko</label>
                    <input type="text" id="lastName" required>
                </div>
                
                <div class="form-group">
                    <label for="gender">Płeć</label>
                    <select id="gender" required>
                        <option value="">Wybierz płeć</option>
                        <option value="mężczyzna">Mężczyzna</option>
                        <option value="kobieta">Kobieta</option>
                        <option value="inna">Inna</option>
                    </select>
                </div>

                <div class="form-group date-group">
                    <label>Data urodzenia</label>
                    <div class="date-inputs">
                        <select id="day" required>
                            <option value="">Dzień</option>
                        </select>
                        <select id="month" required>
                            <option value="">Miesiąc</option>
                            <option value="1">Styczeń</option>
                            <option value="2">Luty</option>
                            <option value="3">Marzec</option>
                            <option value="4">Kwiecień</option>
                            <option value="5">Maj</option>
                            <option value="6">Czerwiec</option>
                            <option value="7">Lipiec</option>
                            <option value="8">Sierpień</option>
                            <option value="9">Wrzesień</option>
                            <option value="10">Październik</option>
                            <option value="11">Listopad</option>
                            <option value="12">Grudzień</option>
                        </select>
                        <select id="year" required>
                            <option value="">Rok</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                            <option value="2019">2019</option>
                            <option value="2018">2018</option>
                            <option value="2017">2017</option>
                            <option value="2016">2016</option>
                            <option value="2015">2015</option>
                            <option value="2014">2014</option>
                            <option value="2013">2013</option>
                            <option value="2012">2012</option>
                            <option value="2011">2011</option>
                            <option value="2010">2010</option>
                            <option value="2009">2009</option>
                            <option value="2008">2008</option>
                            <option value="2007">2007</option>
                            <option value="2006">2006</option>
                            <option value="2005">2005</option>
                            <option value="2004">2004</option>
                            <option value="2003">2003</option>
                            <option value="2002">2002</option>
                            <option value="2001">2001</option>
                            <option value="2000">2000</option>
                            <option value="1999">1999</option>
                            <option value="1998">1998</option>
                            <option value="1997">1997</option>
                            <option value="1996">1996</option>
                            <option value="1995">1995</option>
                            <option value="1994">1994</option>
                            <option value="1993">1993</option>
                            <option value="1992">1992</option>
                            <option value="1991">1991</option>
                            <option value="1990">1990</option>
                            <option value="1989">1989</option>
                            <option value="1988">1988</option>
                            <option value="1987">1987</option>
                            <option value="1986">1986</option>
                            <option value="1985">1985</option>
                            <option value="1984">1984</option>
                            <option value="1983">1983</option>
                            <option value="1982">1982</option>
                            <option value="1981">1981</option>
                            <option value="1980">1980</option>
                            <option value="1979">1979</option>
                            <option value="1978">1978</option>
                            <option value="1977">1977</option>
                            <option value="1976">1976</option>
                            <option value="1975">1975</option>
                            <option value="1974">1974</option>
                            <option value="1973">1973</option>
                            <option value="1972">1972</option>
                            <option value="1971">1971</option>
                            <option value="1970">1970</option>
                            <option value="1969">1969</option>
                            <option value="1968">1968</option>
                            <option value="1967">1967</option>
                            <option value="1966">1966</option>
                            <option value="1965">1965</option>
                            <option value="1964">1964</option>
                            <option value="1963">1963</option>
                            <option value="1962">1962</option>
                            <option value="1961">1961</option>
                            <option value="1960">1960</option>
                            <option value="1959">1959</option>
                            <option value="1958">1958</option>
                            <option value="1957">1957</option>
                            <option value="1956">1956</option>
                            <option value="1955">1955</option>
                            <option value="1954">1954</option>
                            <option value="1953">1953</option>
                            <option value="1952">1952</option>
                            <option value="1951">1951</option>
                            <option value="1950">1950</option>
                            <option value="1949">1949</option>
                            <option value="1948">1948</option>
                            <option value="1947">1947</option>
                            <option value="1946">1946</option>
                            <option value="1945">1945</option>
                            <option value="1944">1944</option>
                            <option value="1943">1943</option>
                            <option value="1942">1942</option>
                            <option value="1941">1941</option>
                            <option value="1940">1940</option>
                            <option value="1939">1939</option>
                            <option value="1938">1938</option>
                            <option value="1937">1937</option>
                            <option value="1936">1936</option>
                            <option value="1935">1935</option>
                            <option value="1934">1934</option>
                            <option value="1933">1933</option>
                            <option value="1932">1932</option>
                            <option value="1931">1931</option>
                            <option value="1930">1930</option>
                            <option value="1929">1929</option>
                            <option value="1928">1928</option>
                            <option value="1927">1927</option>
                            <option value="1926">1926</option>
                            <option value="1925">1925</option>
                            <option value="1924">1924</option>
                            <option value="1923">1923</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Hasło</label>
                    <input type="password" id="password" required>
                </div>
                
                <div class="form-group">
                    <label for="confirm-password">Potwierdź hasło</label>
                    <div class="password-container">
                        <input type="password" id="confirm-password" required>
                        <label class="show-password">
                            <input type="checkbox" class="show-password-checkbox" id="show-password-checkbox">
                            <span>Pokaż hasło</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="register-btn">Zarejestruj się</button>
                </div>
                
                <div class="form-group">
                    <button type="button" class="google-btn" onclick="registerWithGoogle()">
                        <i class="material-icons">google</i>
                        <span>Zarejestruj się z Google</span>
                    </button>
                </div>
                
                <div class="form-group">
                    <p>Masz już konto? <a href="login.html">Zaloguj się</a></p>
                </div>
            </form>

            <script>
                // Funkcja do sprawdzania czy rok jest przestępny
                function isLeapYear(year) {
                    return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
                }

                // Funkcja do aktualizacji dni w zależności od miesiąca
                function updateDays(month, year) {
                    const daySelect = document.getElementById('day');
                    daySelect.innerHTML = '<option value="">Dzień</option>';

                    let maxDays;
                    switch(month) {
                        case '2':
                            maxDays = isLeapYear(year) ? 29 : 28;
                            break;
                        case '4':
                        case '6':
                        case '9':
                        case '11':
                            maxDays = 30;
                            break;
                        default:
                            maxDays = 31;
                    }

                    for (let i = 1; i <= maxDays; i++) {
                        daySelect.innerHTML += `<option value="${i}">${i}</option>`;
                    }
                }

                // Funkcja do obliczania wieku
                function calculateAge(day, month, year) {
                    const today = new Date();
                    const birthDate = new Date(year, month - 1, day);
                    let age = today.getFullYear() - birthDate.getFullYear();
                    const m = today.getMonth() - birthDate.getMonth();
                    
                    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                        age--;
                    }
                    return age;
                }

                // Funkcja do sprawdzania czy użytkownik ma co najmniej 13 lat
                function checkAge() {
                    const day = parseInt(document.getElementById('day').value);
                    const month = parseInt(document.getElementById('month').value);
                    const year = parseInt(document.getElementById('year').value);
                    
                    if (day && month && year) {
                        const age = calculateAge(day, month, year);
                        if (age < 13) {
                            alert('Musisz mieć co najmniej 13 lat, aby założyć konto.');
                            document.getElementById('day').value = '';
                            document.getElementById('month').value = '';
                            document.getElementById('year').value = '';
                            return false;
                        }
                        return true;
                    }
                    return false;
                }

                // Zaktualizuj dni przy zmianie miesiąca lub roku
                document.getElementById('month').addEventListener('change', function() {
                    const month = this.value;
                    const year = document.getElementById('year').value;
                    if (month && year) {
                        updateDays(month, year);
                    }
                });

                document.getElementById('year').addEventListener('change', function() {
                    const year = this.value;
                    const month = document.getElementById('month').value;
                    if (month && year) {
                        updateDays(month, year);
                    }
                });

                // Dodajemy sprawdzanie wieku przy zmianie wartości selectów
                document.getElementById('day').addEventListener('change', checkAge);
                document.getElementById('month').addEventListener('change', checkAge);
                document.getElementById('year').addEventListener('change', checkAge);

                document.getElementById('register-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('username').value;
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirm-password').value;
                    const day = document.getElementById('day').value;
                    const month = document.getElementById('month').value;
                    const year = document.getElementById('year').value;
                    const firstName = document.getElementById('firstName').value;
                    const lastName = document.getElementById('lastName').value;
                    const gender = document.getElementById('gender').value;

                    if (password !== confirmPassword) {
                        alert('Hasła nie są takie same!');
                        return;
                    }

                    if (!checkAge()) {
                        return;
                    }

                    try {
                        await register(username, email, password, day, month, year, firstName, lastName, gender);
                        window.location.href = 'index.html';
                    } catch (error) {
                        alert('Błąd rejestracji: ' + error.message);
                    }
                });
            </script>
        </div>
    </div>


    <script>
        // Obsługa pokazywania/ukrywania hasła w rejestracji
        document.addEventListener('DOMContentLoaded', function() {
            const showPasswordCheckbox = document.getElementById('show-password-checkbox');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm-password');

            showPasswordCheckbox.addEventListener('change', function() {
                const isPasswordVisible = this.checked;
                
                // Aktualizacja typu inputów
                passwordInput.type = isPasswordVisible ? 'text' : 'password';
                confirmPasswordInput.type = isPasswordVisible ? 'text' : 'password';
            });
        });
    </script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script>
        // Inicjalizacja Firebase od razu po załadowaniu configu
        initializeFirebase();
    </script>
    <script src="js/auth.js"></script>
    <script>
        // Przekieruj po pomyślnym rejestracji
        function handleRedirectAfterRegister() {
            if (window.auth && typeof window.auth.onAuthStateChanged === 'function') {
                window.auth.onAuthStateChanged(user => {
                    if (user) {
                        window.location.href = 'index.html';
                    }
                });
            } else {
                // Poczekaj na inicjalizację Firebase
                window.addEventListener('firebase-initialized', () => {
                    if (window.auth && typeof window.auth.onAuthStateChanged === 'function') {
                        window.auth.onAuthStateChanged(user => {
                            if (user) {
                                window.location.href = 'index.html';
                            }
                        });
                    }
                });
            }
        }
        handleRedirectAfterRegister();
    </script>
</body>
</html>
